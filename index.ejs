<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Portfolio</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="container">
      <a href="/logout" class="logout-btn">Logout</a>
      <h1>My Crypto Portfolio</h1>

      <div class="card">
        <h3>Add Asset</h3>
        <form action="/portfolio/add" method="POST">
          <select name="coinId" required>
            <option value="bitcoin">Bitcoin (BTC)</option>
            <option value="ethereum">Ethereum (ETH)</option>
            <option value="dogecoin">Dogecoin (DOGE)</option>
            <option value="solana">Solana (SOL)</option>
            <option value="cardano">Cardano (ADA)</option>
          </select>
          <input
            type="number"
            name="amount"
            step="any"
            placeholder="Amount owned"
            required
          />
          <button type="submit">Track</button>
        </form>
      </div>

      <div class="card">
        <h3>Current Holdings</h3>
        <% if (typeof error !== 'undefined') { %>
        <p style="color: red"><%= error %></p>
        <% } %>

        <table>
          <thead>
            <tr>
              <th>Asset</th>
              <th>Amount</th>
              <th>Market Price</th>
              <th>Your Value</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% let totalValue = 0; %> <% portfolio.forEach(item => { %> <% //
            Check if API returned price, else default to 0 const price =
            prices[item.coinId] ? prices[item.coinId].usd : 0; const val =
            (price * item.amount).toFixed(2); totalValue += parseFloat(val); %>
            <tr>
              <td><%= item.coinName %></td>
              <td><%= item.amount %></td>
              <td>$<%= price.toLocaleString() %></td>
              <td style="color: #00ff41">$<%= val %></td>
              <td>
                <form
                  action="/portfolio/delete"
                  method="POST"
                  style="margin: 0"
                >
                  <input type="hidden" name="id" value="<%= item._id %>" />
                  <button
                    type="submit"
                    style="background: #ff4444; color: white; padding: 2px 8px"
                  >
                    X
                  </button>
                </form>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>

        <h2 style="text-align: right; margin-top: 20px">
          Total Net Worth: $<%= totalValue.toLocaleString() %>
        </h2>
      </div>
    </div>
  </body>
</html>
